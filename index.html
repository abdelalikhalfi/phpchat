<!doctype html>
<html lang="en">
		<head>
				<meta charset="UTF-8"/>
				<title>Chat</title>
				<link rel="stylesheet" href="https://unpkg.com/picnic">
				<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

				<style>
				 #logo {
						 font-size: 120px;
						 line-height: 80px;
				 }

				 section {
						 padding-top: 3em;
						 margin: auto;
						 width: 80%;
				 }

				 section a {
						 color: black;
						 text-decoration: underline;
				 }
				 section a:hover {
						 color: gray;
				 }
				</style>
		</head>
		<body>

				<section>
						<!-- <textarea cols="30" id="" name="" rows="10"></textarea> -->
						<h1>Chat application develop√© par php</h1>
						<fleidset class="flex two">
								<div>
										<input id="name" name="" type="text" value="" placeholder="Name"/>
										<textarea cols="30" id="user" name="" rows="10" style="resize: none" placeholder="Contents"></textarea>
										<button type="submit" onclick="send()">Envoyer</button>
								</div>
								<div id="view" style="overflow: scroll; height: calc(100vh - 10em)">
								</div>
						</fleidset>
				</section>

				<script>
				 const es = new EventSource(window.location.href+'sender.php');
				 const view = document.getElementById('view');

				 var Base64 = {
						 encode: function(str) {
								 return btoa(unescape(encodeURIComponent(str)));
						 },
						 decode: function(str) {
								 return decodeURIComponent(escape(atob(str)));
						 }
				 };

				 function send() {
						 fetch(window.location.href+'receiver.php?name='+Base64.encode(document.getElementById('name').value)+'&q='+Base64.encode(document.getElementById('user').value));
				 }

				 es.addEventListener('message', function (event) {
						 let message = event.data;
						 console.log(message);
						 let html = `
								 <article class="card">
										 <header>
												 ${message.split(" ")[0]}
										 </header>
										 <footer>
												 ${message.split(" ").slice(1).join(" ").replace(/%\\n/g, "<br>")}
										 </footer>
								 </article>
						 `;
						 view.innerHTML = html + view.innerHTML;
				 });

				 es.onerror = function (event) {
						 switch (es.readyState) {
								 case EventSource.CONNECTING:
										 break;
								 case EventSource.CLOSED:
										 break;
						 }
				 };
				</script>

				
		</body>
</html>
